{% extends "base.html" %}
{% block id %} {{id}} {% endblock %}

{% block top %} 
<div class="text-center">
	<h2> Task: {{task}} </h2>
	<h3 id = "stage"> </h3>
</div>
{% endblock %}

{% block left %} 
<div class="text-center">
	<div class = "row">
	<div class="vid column1">
		<div class="col-md-2 col-md-offset-4" id = "video">

		</div>
	</div>
</div>


 	<div id="exp">
 	
	</div>
</div>

{% endblock %}

{% block right %}

<div id = "questions">

</div>

<div id="qsubmit">
</div>

<div id= "error"> </div>


{% endblock %} 

{% block bot %}
<br>
<br>
<br>
<div class = "text-center">
	<form action="/hints" method="POST" target="_blank">
		<input type="submit" value="Environment Configuration">
	</form>
</div>
{% endblock %}

{% block script %}
<script>

$(document).ready(function () {
	var state = 1;
	var question = 1;
	var okSkip = 0;

	var exp = false;
	var ans1 = [];
	var ans2 = [];
	var ans3 = [];
	var ans4 = [];
	var ans5 = [];
	var ans6 = [];
	var ans7 = [];	

	if("{{explanation}}" == "True")
		exp = true;
	else
		exp = false;
	
	var startTime, endTime, timeDiff;

	if(exp == false)
		question = 2;

	startTime = new Date();
	renderVideo(0,0)
	$("#stage").empty().append("stage: "+ state);
	
	$("#video").on('click', '#vend', function () {
		if(state == 3)
			renderSurvey(1);
		else
			renderQuestion(state,question);

		$("#qsubmit").empty().append("<button>submit</button>");
		$("#video").empty();
		$("#stage").empty().append("stage: "+ state);
	
		
	});

	$("#qsubmit" ).click( function(event){
		next(true);
		
	});

    // parameters: state and value of the submitted response
	function renderExplanation(s, v,q)
	{
		switch(s.toString()+v.toString()+q.toString()){
			case "111" :
				$("#exp").empty().append(
				`	<h3> Explanation: </h3>
					<STRONG>You asked: </STRONG> What are you going to do? <br>
					<div class = "row col-md-offset-2">
					<div class="column3">
    				<figure>
						<img src="static/img/hand_empty.png"  height="100" width="100"/>
					</figure>
					</div>

					<div class = "column3">
    				<figure>
						<img src="static/img/arrow.jpg"  height="100" width="100"/>
					</figure>
					</div>
					<div class="column3">
					  <figure>
						<img src="static/img/hand_orange.png"  height="100" width="100"/>
					</figure>
					</div>
					</div>
				`
    			);
				break;
			case "121":
			$("#exp").empty().append(
				`	<h3> Explanation: </h3>
					<STRONG>You asked: </STRONG>
				 	Are you looking for something? <br> 
					<div class = "row col-md-offset-2">
					<div class="column1">
					  <figure>
						<img src="static/img/hand_orange.png"  height="100" width="100"/>
					</figure>
					</div>
					</div>
				`
    			);

			break;

			case "211" :
				$("#exp").empty().append(
				`	<h3> Explanation: </h3>
					<STRONG>You asked: </STRONG>
					What are you going to do? <br>
					<div class = "row col-md-offset-2">
					<div class="column3">
    				<figure>
						<img src="static/img/hand_empty.png"  height="100" width="100"/>
					</figure>
					</div>

					<div class = "column3">
    				<figure>
						<img src="static/img/arrow.jpg"  height="100" width="100"/>
					</figure>
					</div>
					<div class="column3">
					  <figure>
						<img src="static/img/hand_cup.png"  height="100" width="100"/>
					</figure>
					</div>
					</div>
				`
    			);
				break;
			case "221":
			$("#exp").empty().append(
				`	<h3> Explanation: </h3>
					<STRONG>You asked: </STRONG>
					Are you looking for something? <br> 
					<div class = "row col-md-offset-2">
					<div class="column1">
					  <figure>
						<img src="static/img/hand_cup.png"  height="100" width="100"/>
					</figure>
					</div>
					</div>
				`
    			);

			break;			
			default:
			break

		}

	}


	function renderQuestion(s,q)
	{

		switch(s.toString()+q.toString())
		{
			case "11":
			if(okSkip == 1)
			$("#questions").empty().append(
			`
			<STRONG>You can ask the following questions to the robot </STRONG> <br>
			<INPUT TYPE="radio" NAME="q" VALUE="1">What are you going to do? <br>
			<INPUT TYPE="radio" NAME="q" VALUE="2"> Are you looking for something? <br> 
			<INPUT TYPE="radio" NAME="q" VALUE="3"> I don't want to ask anything <br>
			<br>
			
			`
			);
			else
			{
			$("#questions").empty().append(
			`
			<STRONG>You can ask the following questions to the robot</STRONG> <br>
			<INPUT TYPE="radio" NAME="q" VALUE="1">What are you going to do? <br>
			<INPUT TYPE="radio" NAME="q" VALUE="2"> Are you looking for something? <br> 
			<br>
			
			`
			);				
			}

			break;


			case "12":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, what is the robot going to do?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Use the juicer <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Take the Knife <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Take the Cup <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Take the orange <br>
					<br>
					
    				`
    			);
			break;

			case "13":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, where does the robot think the <STRONG>orange</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> In the cabinet <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> On the table next to the cutboard  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Next to sink <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Robot has no idea  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> I am not sure if the robot knows or not. <br>
					<br>
					
    				`
    			);

			break;

			case "14":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, where does the robot think the <STRONG>knife</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> I am not sure if the robot knows or not. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> On the table next to the cutboard <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> In the cabinet<br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Robot has no idea  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Next to sink  <br>
					<br>
				
    				`
    			); 
			break;
			case "15":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question  For You</STRONG>:In your opinion, where does the robot think the <STRONG>cup</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> In the cabinet <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Robot has no idea  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Next to sink <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> On the table next to the cutboard <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> I am not sure if the robot knows or not. <br>
					<br>
					
    				`
    			);    					
			break;

			case "16":
			  $("#questions").empty().append(
    				`
    				<STRONG>Can you provide some help to the robot</STRONG>:  actions (to do after the pause): <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> point to the cup <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> point to the cabinet  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> point to the knife  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> point to the juicer  <br>
					<br>
					
    				`
    			);
			break;

			case "21":
			if(okSkip == 1)
			$("#questions").empty().append(
			`
			<STRONG>You can ask the following questions to the robot </STRONG> <br>
			<INPUT TYPE="radio" NAME="q" VALUE="1">What are you going to do? <br>
			<INPUT TYPE="radio" NAME="q" VALUE="2"> Are you looking for something? <br> 
			<INPUT TYPE="radio" NAME="q" VALUE="3"> I don't want to ask anything <br>
			<br>
			
			`
			);
			else
			{
			$("#questions").empty().append(
			`
			<STRONG>You can ask the following questions </STRONG> <br>
			<INPUT TYPE="radio" NAME="q" VALUE="1">What are you going to do? <br>
			<INPUT TYPE="radio" NAME="q" VALUE="2"> Are you looking for something? <br> 
			<br>
			
			`
			);				
			}

			break;


			case "22":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, what is the robot going to do?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Use the juicer <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Take the Knife <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Take the Cup <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Take the orange <br>
					<br>
					
    				`
    			);
			break;

			case "23":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, where does the robot think the <STRONG>orange</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> In the cabinet <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> On the cutboard  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Next to sink <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Robot has no idea  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> I am not sure if the robot knows or not.  <br>
					<br>
					
    				`
    			);

			break;

			case "24":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, where does the robot think the <STRONG>knife</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> I am not sure if the robot knows or not. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> On the table next to the cutboard <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> In the cabinet <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Robot has no idea  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Next to sink <br>
					<br>
				
    				`
    			); 
			break;
			case "25":
			  $("#questions").empty().append(
    				`
    				<STRONG>Question For You</STRONG>:In your opinion, where does the robot think the <STRONG>cup</STRONG> is?: <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> In the cabinet <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Robot has no idea <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Next to sink <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> On the table next to the cutboard <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> I am not sure if the robot knows or not. <br>
					<br>
					
    				`
    			);    					
			break;

			case "26":
			  $("#questions").empty().append(
    				`
    				<STRONG>Can you provide some help to the robot</STRONG>:  actions (to do after the pause): <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> point to the cup <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> point to the cabinet  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> point to the knife  <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> point to the juicer  <br>
					<br>
					
    				`
    			);
			break;

			default:
				$("#questions").empty();
				break;			
		}
	}

	// parameters: state and wether the previous action choice is correct: 1 means correct, 0 means incorrect
	function renderVideo(s,v)
	{
		
		switch(s.toString()+v.toString())
		{
			// default start up rendering
			case "00":
			$("#video").empty().append(
			`
			<iframe width="320" height="240"
				src="https://www.youtube.com/embed/L2kzkqMqQEQ?autoplay=1"  allowfullscreen >
			</iframe>
			<button id ="vend"> I finished watching video </button>
			`
			);

			break;
			case "12":
			$("#video").empty().append(
			`
			<iframe width="320" height="240"
				src="https://www.youtube.com/embed/j646WBkU6Dk?autoplay=1" allowfullscreen>
			</iframe>
			<button id ="vend"> I finished watching video </button>
			`
			);
			break;

			case "11":
			case "13":
			case "14":
			$("#video").empty().append(
			`
			<iframe width="320" height="240"
				src="https://www.youtube.com/embed/FfhYMEfteFM?autoplay=1" allowfullscreen>
			</iframe>
			<button id="vend"> I finished watching video </button>
			`
			);

			break;

			case "21":
			$("#video").empty().append(
			`
			<iframe width="320" height="240"
				src="https://www.youtube.com/embed/o-kot11-V8Q?autoplay=1" allowfullscreen>
			</iframe>
			<button id ="vend"> I finished watching video </button>
			`
			);
			break;

			case "22":
			case "23":
			case "24":
			$("#video").empty().append(
			`
			<iframe width="320" height="240"
				src="https://www.youtube.com/embed/kYKd5rmX7J0?autoplay=1" allowfullscreen>
			</iframe>
			<button id ="vend"> I finished watching video </button>
			`
			);
			break;			
			default:
			$("#video").empty();
			break;
		}
	}

	function renderSurvey(q)
	{
		switch(q.toString())
		{

			case "1":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: I understand how the robot works. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			);    				
			break;

			case "2":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: I think the robot is reliable. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;


			case "3":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: I think the explanation system is not efficient for users to receive explanations. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;

			case "4":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: The explanations the robot gives have sufficient detail. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;

			case "5":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: The explanations the robot gives are useful to understand its plan. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;


			case "6":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: The explanations the robot gives are not satisfying. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;

			case "7":
			$("#questions").empty().append(
    				`
    				<STRONG>Post Experiment Evaluation</STRONG>: The explanations the robot gives are clear. <br>
					<INPUT TYPE="radio" NAME="q" VALUE="1"> Strongly Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="2"> Disagree <br>
					<INPUT TYPE="radio" NAME="q" VALUE="3"> Neutral   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="4"> Agree   <br>
					<INPUT TYPE="radio" NAME="q" VALUE="5"> Strongly Agree   <br>
					<br>
    				`
    			); 

			break;



		}

	}

	function next(renderq= true)
	{	
		if(state < 3)
		{
			value = "";
			$("#error").empty();
			if ($("input[name=q]").is(':checked'))
			{
				value = $("input[name=q]:checked").val();
			}
			else{
				$("#error").empty().append("Please complete the form before submit");
				return; 
			}

			
			if(question==1)
				okSkip = 1;
			// first choice
			
			switch (question)
			{
				
				case 1:
				ans1.push(value);
				break;

				case 2:
				ans2.push(value);
				break;

				case 3:
				ans3.push(value);
				break;

				case 4:
				ans4.push(value);
				break;

				case 5:
				ans5.push(value);
				break;system

				case 6:
				ans6.push(value);
				break;
			
			}
			
			
			renderExplanation(state, value,question );
		
			if (question == 6)
			{
				renderVideo(state, value);
				
				$("#qsubmit").empty();
				$("#questions").empty();
				$("#exp").empty();
				
				okSkip = 0;
				state++;
				if(exp)
					question = 1;
				else
					question = 2;


				if(state == 3 )
			  	{
					question = 1;
					endTime =  new Date();
					timeDiff = endTime-startTime;
					timeDiff /= 1000;
					
			  	}


			  

			}
			else if( (question != 1 || (question == 1 && value == 3)) )
			{
				question++;
				renderQuestion(state, question);
			} else if (question == 1)
			{
				renderQuestion(state, question);
			}



		}
		else
		{
				value = "";
				$("#error").empty();
				if ($("input[name=q]").is(':checked'))
				{
					value = $("input[name=q]:checked").val();
				}
				else{
					$("#error").empty().append("Please complete the form before submit");
					return; 
				}

				ans7.push(value);

				
				if(question  == 7 || (!exp && question == 2))
				{
					
					ans = JSON.stringify({"ans" : [ans1, ans2, ans3. ans4, ans5, ans6, ans7], "explanation" : "{{explanation}}", "time" : timeDiff });
					
           			$.ajax({
                	type: 'POST',
                	data: ans,
                	dataType: 'json',
                	contentType: 'application/json',
                	url: '/result',

                	success: function (e) {
                    	window.location.href = "/final";
                	},
                	error: function(error) {
            			console.log("error");
                		
           			 }
            		});
				}
				question++;
				renderSurvey(question);

		}

		$("#stage").empty().append("stage: "+ state);

	}






});
</script>

{% endblock %} 